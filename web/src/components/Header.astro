---
// src/components/Header.astro
import { client } from '../lib/sanityClient';

const query = `
  *[
    (_type == "navigation") ||
    (_type == "page" && showInMenu == true && category == 'general')
  ]{
    ...,
    // EÄŸer bu bir "Hikayem" aÃ§Ä±lÄ±r menÃ¼sÃ¼ ise, ilgili tÃ¼m hikaye bÃ¶lÃ¼mlerini de Ã§ek
    "submenuItems": *[_type == "page" && category == "storyChapter" && ^.menuType == 'dropdownStory'] | order(chapterNumber asc) { // <-- DEÄžÄ°ÅžÄ°KLÄ°K BURADA
      title,
      "slug": slug.current
    }
  } | order(menuOrder asc)
`;

const navItems = await client.fetch(query);
const settings = await client.fetch(`*[_type == "siteSettings"][0]{siteLogoText}`);
---
<header>
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <span>{settings?.siteLogoText || 'ðŸ§  LOGOS'}</span>
            </div>
            <nav>
                <ul>
                    {navItems.map(item => {
                        const isDropdown = item.menuType === 'dropdownStory' && item.submenuItems?.length > 0;
                        const url = item._type === 'page' ? `/${item.slug.current}` : item.linkUrl;
                        const title = item._type === 'page' ? item.title : item.linkTitle;
                        
                        return (
                            <li class:list={[{'has-dropdown': isDropdown}]}>
                                <a href={isDropdown ? '#' : url}>{title}</a>
                                {isDropdown && (
                                    <ul class="dropdown-menu">
                                        {item.submenuItems.map(subItem => (
                                            <li><a href={`/${subItem.slug}`}>{subItem.title}</a></li>
                                        ))}
                                    </ul>
                                )}
                            </li>
                        );
                    })}
                </ul>
            </nav>
        </div>
    </div>
</header>