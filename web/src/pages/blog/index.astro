---
// src/pages/blog/index.astro
import Layout from '../../layouts/Layout.astro';
import { client, urlFor } from '../../lib/sanityClient'; // urlFor'u import ediyoruz

const query = `{
  "settings": *[_type == "siteSettings"][0],
  "posts": *[_type == "post"] | order(postDate desc)
}`;

const { settings, posts } = await client.fetch(query);

function formatDate(dateString: string) {
    if (!dateString) return '';
    return new Date(dateString).toLocaleDateString('tr-TR', {
        day: 'numeric', month: 'long', year: 'numeric'
    });
}
---
<Layout>
    <section class="container">
        <h2 class="section-title">{settings.blogPageTitle || 'Tüm Makaleler'}</h2>
        
        <div class="accordion-list">
            {posts && posts.length > 0 ? (
                posts.map(post => (
                    <details class="accordion-item">
                        <summary>{post.postTitle}</summary>
                        <div class="accordion-content">
                            <div class="post-meta" style="margin-bottom: 15px;">
                                <span class="category">{post.postCategory}</span>
                                <span class="date">{formatDate(post.postDate)}</span>
                            </div>
                            <p>{post.postSummary}</p>
                            <a href={`/blog/${post.postSlug?.current}`} class="read-more">Devamını Oku →</a>
                        </div>
                    </details>
                ))
            ) : (
                <p style="text-align: center;">Yayınlanmış hiç makale bulunamadı.</p>
            )}
        </div>
    </section>
</Layout>